<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Julia Garbage Collector (GC) Internals · The Julia Language</title><meta name="title" content="Julia Garbage Collector (GC) Internals · The Julia Language"/><meta property="og:title" content="Julia Garbage Collector (GC) Internals · The Julia Language"/><meta property="twitter:title" content="Julia Garbage Collector (GC) Internals · The Julia Language"/><meta name="description" content="Documentation for The Julia Language."/><meta property="og:description" content="Documentation for The Julia Language."/><meta property="twitter:description" content="Documentation for The Julia Language."/><meta property="og:url" content="https://docs.julialang.org/en/v1/devdocs/gc/"/><meta property="twitter:url" content="https://docs.julialang.org/en/v1/devdocs/gc/"/><link rel="canonical" href="https://docs.julialang.org/en/v1/devdocs/gc/"/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-28835595-6"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-28835595-6', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/julia-manual.css" rel="stylesheet" type="text/css"/><link href="../../assets/julia.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="The Julia Language logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="The Julia Language logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Julia Documentation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/getting-started/">Getting Started</a></li><li><a class="tocitem" href="../../manual/installation/">Installation</a></li><li><a class="tocitem" href="../../manual/variables/">Variables</a></li><li><a class="tocitem" href="../../manual/integers-and-floating-point-numbers/">Integers and Floating-Point Numbers</a></li><li><a class="tocitem" href="../../manual/mathematical-operations/">Mathematical Operations and Elementary Functions</a></li><li><a class="tocitem" href="../../manual/complex-and-rational-numbers/">Complex and Rational Numbers</a></li><li><a class="tocitem" href="../../manual/strings/">Strings</a></li><li><a class="tocitem" href="../../manual/functions/">Functions</a></li><li><a class="tocitem" href="../../manual/control-flow/">Control Flow</a></li><li><a class="tocitem" href="../../manual/variables-and-scoping/">Scope of Variables</a></li><li><a class="tocitem" href="../../manual/types/">Types</a></li><li><a class="tocitem" href="../../manual/methods/">Methods</a></li><li><a class="tocitem" href="../../manual/constructors/">Constructors</a></li><li><a class="tocitem" href="../../manual/conversion-and-promotion/">Conversion and Promotion</a></li><li><a class="tocitem" href="../../manual/interfaces/">Interfaces</a></li><li><a class="tocitem" href="../../manual/modules/">Modules</a></li><li><a class="tocitem" href="../../manual/documentation/">Documentation</a></li><li><a class="tocitem" href="../../manual/metaprogramming/">Metaprogramming</a></li><li><a class="tocitem" href="../../manual/arrays/">Single- and multi-dimensional Arrays</a></li><li><a class="tocitem" href="../../manual/missing/">Missing Values</a></li><li><a class="tocitem" href="../../manual/networking-and-streams/">Networking and Streams</a></li><li><a class="tocitem" href="../../manual/parallel-computing/">Parallel Computing</a></li><li><a class="tocitem" href="../../manual/asynchronous-programming/">Asynchronous Programming</a></li><li><a class="tocitem" href="../../manual/multi-threading/">Multi-Threading</a></li><li><a class="tocitem" href="../../manual/distributed-computing/">Multi-processing and Distributed Computing</a></li><li><a class="tocitem" href="../../manual/running-external-programs/">Running External Programs</a></li><li><a class="tocitem" href="../../manual/calling-c-and-fortran-code/">Calling C and Fortran Code</a></li><li><a class="tocitem" href="../../manual/handling-operating-system-variation/">Handling Operating System Variation</a></li><li><a class="tocitem" href="../../manual/environment-variables/">Environment Variables</a></li><li><a class="tocitem" href="../../manual/embedding/">Embedding Julia</a></li><li><a class="tocitem" href="../../manual/code-loading/">Code Loading</a></li><li><a class="tocitem" href="../../manual/profile/">Profiling</a></li><li><a class="tocitem" href="../../manual/stacktraces/">Stack Traces</a></li><li><a class="tocitem" href="../../manual/memory-management/">Memory Management and Garbage Collection</a></li><li><a class="tocitem" href="../../manual/performance-tips/">Performance Tips</a></li><li><a class="tocitem" href="../../manual/workflow-tips/">Workflow Tips</a></li><li><a class="tocitem" href="../../manual/style-guide/">Style Guide</a></li><li><a class="tocitem" href="../../manual/faq/">Frequently Asked Questions</a></li><li><a class="tocitem" href="../../manual/noteworthy-differences/">Noteworthy Differences from other Languages</a></li><li><a class="tocitem" href="../../manual/unicode-input/">Unicode Input</a></li><li><a class="tocitem" href="../../manual/command-line-interface/">Command-line Interface</a></li><li><a class="tocitem" href="../../manual/worldage/">The World Age mechanism</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Base</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../base/base/">Essentials</a></li><li><a class="tocitem" href="../../base/collections/">Collections and Data Structures</a></li><li><a class="tocitem" href="../../base/math/">Mathematics</a></li><li><a class="tocitem" href="../../base/numbers/">Numbers</a></li><li><a class="tocitem" href="../../base/strings/">Strings</a></li><li><a class="tocitem" href="../../base/arrays/">Arrays</a></li><li><a class="tocitem" href="../../base/parallel/">Tasks</a></li><li><a class="tocitem" href="../../base/multi-threading/">Multi-Threading</a></li><li><a class="tocitem" href="../../base/scopedvalues/">Scoped Values</a></li><li><a class="tocitem" href="../../base/constants/">Constants</a></li><li><a class="tocitem" href="../../base/file/">Filesystem</a></li><li><a class="tocitem" href="../../base/io-network/">I/O and Network</a></li><li><a class="tocitem" href="../../base/punctuation/">Punctuation</a></li><li><a class="tocitem" href="../../base/sort/">Sorting and Related Functions</a></li><li><a class="tocitem" href="../../base/iterators/">Iteration utilities</a></li><li><a class="tocitem" href="../../base/reflection/">Reflection and introspection</a></li><li><a class="tocitem" href="../../base/c/">C Interface</a></li><li><a class="tocitem" href="../../base/libc/">C Standard Library</a></li><li><a class="tocitem" href="../../base/stacktraces/">StackTraces</a></li><li><a class="tocitem" href="../../base/simd-types/">SIMD Support</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Standard Library</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../stdlib/ArgTools/">ArgTools</a></li><li><a class="tocitem" href="../../stdlib/Artifacts/">Artifacts</a></li><li><a class="tocitem" href="../../stdlib/Base64/">Base64</a></li><li><a class="tocitem" href="../../stdlib/CRC32c/">CRC32c</a></li><li><a class="tocitem" href="../../stdlib/Dates/">Dates</a></li><li><a class="tocitem" href="../../stdlib/DelimitedFiles/">Delimited Files</a></li><li><a class="tocitem" href="../../stdlib/Distributed/">Distributed Computing</a></li><li><a class="tocitem" href="../../stdlib/Downloads/">Downloads</a></li><li><a class="tocitem" href="../../stdlib/Libdl/">Dynamic Linker</a></li><li><a class="tocitem" href="../../stdlib/FileWatching/">File Events</a></li><li><a class="tocitem" href="../../stdlib/Future/">Future</a></li><li><a class="tocitem" href="../../stdlib/InteractiveUtils/">Interactive Utilities</a></li><li><a class="tocitem" href="../../stdlib/JuliaSyntaxHighlighting/">Julia Syntax Highlighting</a></li><li><a class="tocitem" href="../../stdlib/LazyArtifacts/">Lazy Artifacts</a></li><li><a class="tocitem" href="../../stdlib/LibCURL/">LibCURL</a></li><li><a class="tocitem" href="../../stdlib/LibGit2/">LibGit2</a></li><li><a class="tocitem" href="../../stdlib/LinearAlgebra/">Linear Algebra</a></li><li><a class="tocitem" href="../../stdlib/Logging/">Logging</a></li><li><a class="tocitem" href="../../stdlib/Markdown/">Markdown</a></li><li><a class="tocitem" href="../../stdlib/Mmap/">Memory-mapped I/O</a></li><li><a class="tocitem" href="../../stdlib/NetworkOptions/">Network Options</a></li><li><a class="tocitem" href="../../stdlib/Pkg/">Pkg</a></li><li><a class="tocitem" href="../../stdlib/Printf/">Printf</a></li><li><a class="tocitem" href="../../stdlib/Profile/">Profiling</a></li><li><a class="tocitem" href="../../stdlib/Random/">Random Numbers</a></li><li><a class="tocitem" href="../../stdlib/REPL/">The Julia REPL</a></li><li><a class="tocitem" href="../../stdlib/Serialization/">Serialization</a></li><li><a class="tocitem" href="../../stdlib/SHA/">SHA</a></li><li><a class="tocitem" href="../../stdlib/SharedArrays/">Shared Arrays</a></li><li><a class="tocitem" href="../../stdlib/Sockets/">Sockets</a></li><li><a class="tocitem" href="../../stdlib/SparseArrays/">Sparse Arrays</a></li><li><a class="tocitem" href="../../stdlib/Statistics/">Statistics</a></li><li><a class="tocitem" href="../../stdlib/StyledStrings/">StyledStrings</a></li><li><a class="tocitem" href="../../stdlib/Tar/">Tar</a></li><li><a class="tocitem" href="../../stdlib/TOML/">TOML</a></li><li><a class="tocitem" href="../../stdlib/Unicode/">Unicode</a></li><li><a class="tocitem" href="../../stdlib/Test/">Unit Testing</a></li><li><a class="tocitem" href="../../stdlib/UUIDs/">UUIDs</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox" checked/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer Documentation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox" checked/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">Documentation of Julia&#39;s Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../init/">Initialization of the Julia runtime</a></li><li><a class="tocitem" href="../ast/">Julia ASTs</a></li><li><a class="tocitem" href="../types/">More about types</a></li><li><a class="tocitem" href="../object/">Memory layout of Julia Objects</a></li><li><a class="tocitem" href="../eval/">Eval of Julia code</a></li><li><a class="tocitem" href="../callconv/">Calling Conventions</a></li><li><a class="tocitem" href="../compiler/">High-level Overview of the Native-Code Generation Process</a></li><li><a class="tocitem" href="../functions/">Julia Functions</a></li><li><a class="tocitem" href="../cartesian/">Base.Cartesian</a></li><li><a class="tocitem" href="../meta/">Talking to the compiler (the <code>:meta</code> mechanism)</a></li><li><a class="tocitem" href="../subarrays/">SubArrays</a></li><li><a class="tocitem" href="../isbitsunionarrays/">isbits Union Optimizations</a></li><li><a class="tocitem" href="../sysimg/">System Image Building</a></li><li><a class="tocitem" href="../pkgimg/">Package Images</a></li><li><a class="tocitem" href="../llvm-passes/">Custom LLVM Passes</a></li><li><a class="tocitem" href="../llvm/">Working with LLVM</a></li><li><a class="tocitem" href="../stdio/">printf() and stdio in the Julia runtime</a></li><li><a class="tocitem" href="../boundscheck/">Bounds checking</a></li><li><a class="tocitem" href="../locks/">Proper maintenance and care of multi-threading locks</a></li><li><a class="tocitem" href="../offset-arrays/">Arrays with custom indices</a></li><li><a class="tocitem" href="../require/">Module loading</a></li><li><a class="tocitem" href="../inference/">Inference</a></li><li><a class="tocitem" href="../ssair/">Julia SSA-form IR</a></li><li><a class="tocitem" href="../EscapeAnalysis/"><code>EscapeAnalysis</code></a></li><li><a class="tocitem" href="../aot/">Ahead of Time Compilation</a></li><li><a class="tocitem" href="../gc-sa/">Static analyzer annotations for GC correctness in C code</a></li><li class="is-active"><a class="tocitem" href>Julia Garbage Collector (GC) Internals</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Allocation"><span>Allocation</span></a></li><li><a class="tocitem" href="#Marking-and-Generational-Collection"><span>Marking and Generational Collection</span></a></li><li><a class="tocitem" href="#Sweeping"><span>Sweeping</span></a></li><li><a class="tocitem" href="#Memory-Accounting"><span>Memory Accounting</span></a></li><li><a class="tocitem" href="#GC-Trigger-Heuristics"><span>GC Trigger Heuristics</span></a></li></ul></li><li><a class="tocitem" href="../gc-mmtk/">Julia + MMTk</a></li><li><a class="tocitem" href="../jit/">JIT Design and Implementation</a></li><li><a class="tocitem" href="../builtins/">Core.Builtins</a></li><li><a class="tocitem" href="../precompile_hang/">Fixing precompilation hangs due to open tasks or IO</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Developing/debugging Julia&#39;s C code</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../backtraces/">Reporting and analyzing crashes (segfaults)</a></li><li><a class="tocitem" href="../debuggingtips/">gdb debugging tips</a></li><li><a class="tocitem" href="../valgrind/">Using Valgrind with Julia</a></li><li><a class="tocitem" href="../external_profilers/">External Profiler Support</a></li><li><a class="tocitem" href="../sanitizers/">Sanitizer support</a></li><li><a class="tocitem" href="../probes/">Instrumenting Julia with DTrace, and bpftrace</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">Building Julia</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../build/build/">Building Julia (Detailed)</a></li><li><a class="tocitem" href="../build/linux/">Linux</a></li><li><a class="tocitem" href="../build/macos/">macOS</a></li><li><a class="tocitem" href="../build/windows/">Windows</a></li><li><a class="tocitem" href="../build/freebsd/">FreeBSD</a></li><li><a class="tocitem" href="../build/arm/">ARM (Linux)</a></li><li><a class="tocitem" href="../build/riscv/">RISC-V (Linux)</a></li><li><a class="tocitem" href="../build/distributing/">Binary distributions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">Contributor&#39;s Guide</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../contributing/code-changes/">Code changes</a></li><li><a class="tocitem" href="../contributing/tests/">Writing tests</a></li><li><a class="tocitem" href="../contributing/documentation/">Improving documentation</a></li><li><a class="tocitem" href="../contributing/jldoctests/">Writing jldoctests</a></li><li><a class="tocitem" href="../contributing/patch-releases/">Contributing to patch releases</a></li><li><a class="tocitem" href="../contributing/formatting/">Code Formatting Guidelines</a></li><li><a class="tocitem" href="../contributing/git-workflow/">Git workflow recommendations</a></li><li><a class="tocitem" href="../contributing/aiagents/">Using AI agents to work on Julia</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer Documentation</a></li><li><a class="is-disabled">Documentation of Julia&#39;s Internals</a></li><li class="is-active"><a href>Julia Garbage Collector (GC) Internals</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Julia Garbage Collector (GC) Internals</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaLang/julia" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaLang/julia/blob/master/doc/src/devdocs/gc.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Julia-Garbage-Collector-(GC)-Internals"><a class="docs-heading-anchor" href="#Julia-Garbage-Collector-(GC)-Internals">Julia Garbage Collector (GC) Internals</a><a id="Julia-Garbage-Collector-(GC)-Internals-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-Garbage-Collector-(GC)-Internals" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>Julia implements a garbage collector (GC) to automate dynamic memory management. Julia&#39;s GC is:</p><ul><li><strong>Mark-sweep</strong>: the object graph is traced starting from a root-set (e.g., global variables and local variables on the stack) to determine the set of live objects.</li><li><strong>Non-moving</strong>: objects are not relocated to a different memory address.</li><li><strong>Parallel</strong>: multiple threads can be used during the marking and sweeping phases.</li><li><strong>Partially concurrent</strong>: the runtime provides an option to scavenge pool-allocated memory blocks (e.g., call <code>madvise</code> on these blocks on Linux) concurrently with Julia user code.</li><li><strong>Generational</strong>: objects are partitioned into generations according to how many collection cycles they&#39;ve survived. Younger generations are collected more often.</li><li><strong>Mostly precise</strong>: Julia optionally supports conservative stack scanning for users who inter-operate with foreign languages like C.</li></ul><h2 id="Allocation"><a class="docs-heading-anchor" href="#Allocation">Allocation</a><a id="Allocation-1"></a><a class="docs-heading-anchor-permalink" href="#Allocation" title="Permalink"></a></h2><p>Julia uses two types of allocators, depending on the size of the allocation request.</p><h3 id="Small-Object-Allocation"><a class="docs-heading-anchor" href="#Small-Object-Allocation">Small Object Allocation</a><a id="Small-Object-Allocation-1"></a><a class="docs-heading-anchor-permalink" href="#Small-Object-Allocation" title="Permalink"></a></h3><p>Sufficiently small objects, up to 2k bytes, are allocated through a per-thread free-list pool allocator.</p><p>Julia&#39;s pool allocator often has better runtime performance than <code>libc</code> <code>malloc</code> for small allocations. Additionally, using a custom pool allocator enables a few optimizations during the sweeping phase (e.g., concurrent scavenging).</p><p>The pool allocator segregates objects on different size classes. Each large memory block (16k bytes) managed by the pool allocator only contains objects belonging to the same size class.</p><p>Each pool-allocated memory block is paired with a metadata structure containing information such as whether the block has live objects at all, the number of free memory slots in the block, the offsets to the first and last objects in the block, etc. This metadata is used to aggregate statistics such as number of objects freed during a collection cycle. It&#39;s also used to optimize the sweeping phase of the GC: blocks that have no live objects whatsoever don&#39;t need to be linearly scanned during the sweeping phase.</p><p>Julia&#39;s pool allocator stores memory blocks into different global lock-free lists depending on whether the block has been mapped but never accessed (<code>page_pool_clean</code>),  whether the page has been lazily swept and it&#39;s waiting to be scavenged by a background GC thread (<code>page_pool_lazily_freed</code>), or whether the page has been scavenged (<code>page_pool_freed</code>).</p><p>The pool allocator uses this partitioning of blocks to implement a tiered allocation discipline. When it requests a fresh memory block, it will:</p><ul><li><p>Try to claim a block from <code>page_pool_lazily_freed</code>, which contains blocks that were empty during the last stop-the-world phase, but haven&#39;t been madvised by a concurrent scavenger GC thread yet.</p></li><li><p>If it failed to claim a block from <code>page_pool_lazily_freed</code>, it will try to claim a block from <code>page_pool_clean</code>, which contains blocks mapped on a previous block allocation request but never accessed.</p></li><li><p>If it failed to claim a block from <code>page_pool_clean</code> and from <code>page_pool_lazily_freed</code>, it will try to claim a block from <code>page_pool_freed</code>, which contains blocks already scavenged by a concurrent scavenger GC thread and whose underlying virtual address can be recycled.</p></li><li><p>If it failed in all of the attempts mentioned above, it will map a batch of operating system pages, partition them into memory blocks, claim one block for itself, and insert the remaining blocks into <code>page_pool_clean</code>.</p></li></ul><p><img src="../img/gc-tiered-allocation.jpg" alt="Diagram of tiered pool allocation"/></p><h3 id="Large-Object-Allocation"><a class="docs-heading-anchor" href="#Large-Object-Allocation">Large Object Allocation</a><a id="Large-Object-Allocation-1"></a><a class="docs-heading-anchor-permalink" href="#Large-Object-Allocation" title="Permalink"></a></h3><p>Sufficiently large objects, above the 2k byte threshold mentioned in the previous section, are allocated through <code>libc</code> <code>malloc</code>. Large allocations are typically less performance-critical than small allocations, as they occur less frequently.</p><p>Although Julia currently uses <code>libc</code> <code>malloc</code>, it also supports pre-loading other dynamic memory allocators (e.g., <code>jemalloc</code>).</p><h2 id="Marking-and-Generational-Collection"><a class="docs-heading-anchor" href="#Marking-and-Generational-Collection">Marking and Generational Collection</a><a id="Marking-and-Generational-Collection-1"></a><a class="docs-heading-anchor-permalink" href="#Marking-and-Generational-Collection" title="Permalink"></a></h2><p>Julia’s mark phase is implemented through a parallel depth-first-search that traverses the object graph to determine which objects are alive.</p><p>Julia stores age information for its generational GC in the object header: the lowest two bits of an object’s header store a mark bit, set when an object is marked, and an age bit, set when the object is promoted. Because Julia’s GC is non-moving, object age information can’t be only determined through the object&#39;s memory address, such as in GC implementations that allocate young objects in certain memory regions and relocate them to other memory regions during object promotion.</p><p>Generational collection is implemented through sticky bits: objects are only pushed to the mark-stack, and therefore traced, if their mark-bits have not been set. When objects reach the oldest generation, their mark-bits aren&#39;t reset during a quick sweep, so these objects aren&#39;t traced during a subsequent mark phase. A full sweep, however, resets the mark-bits of all objects, so all of them are traced in a subsequent collection.</p><p>When the mutator is running, a write barrier intercepts field writes and pushes an object’s address into a per-thread remembered set if the reference crosses generations. Objects in this remembered set are then traced during the next mark phase.</p><h2 id="Sweeping"><a class="docs-heading-anchor" href="#Sweeping">Sweeping</a><a id="Sweeping-1"></a><a class="docs-heading-anchor-permalink" href="#Sweeping" title="Permalink"></a></h2><p>If a memory block managed by the pool allocator contains at least one live object, the sweeping phase creates a free-list from its dead objects; if it doesn&#39;t, then the block is scavenged and its underlying physical memory might be returned to the operating system through, for instance, <code>madvise</code> on Linux.</p><p>The linear scan of memory blocks that have at least one live object can be run with multiple threads. If concurrent page sweeping is enabled through the flag <code>--gcthreads=X,1</code> the GC scavenges memory blocks concurrently with the mutator.</p><p>During the stop-the-world phase of the collector, memory blocks containing no live objects are initially pushed into the <code>page_pool_lazily_freed</code>. The background scavenger thread is then woken up and removes blocks from <code>page_pool_lazily_freed</code>, scavenges them (e.g., <code>madvise</code> on Linux), and inserts them into <code>page_pool_freed</code>. <code>page_pool_lazily_freed</code> is also shared with mutator threads. This can improve performance in some applications because in allocation-heavy multithreaded workloads, mutator threads often avoid a page fault during allocation, which happens by accessing a freshly mapped operating system page or a madvised page, by directly allocating a block from <code>page_pool_lazily_freed</code>. In these workloads, the scavenger thread also needs to scavenge fewer blocks, since some have already been claimed by the mutators.</p><h2 id="Memory-Accounting"><a class="docs-heading-anchor" href="#Memory-Accounting">Memory Accounting</a><a id="Memory-Accounting-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-Accounting" title="Permalink"></a></h2><p>The GC determines the heap size by adding the number of bytes in-use by pool-allocated memory blocks and bytes in-use by objects allocated through the large allocator. Previously, we measured the heap size by adding up the bytes for live objects, but not live memory blocks. This definition ignores fragmentation, which can lead to inaccurate GC decisions.</p><h2 id="GC-Trigger-Heuristics"><a class="docs-heading-anchor" href="#GC-Trigger-Heuristics">GC Trigger Heuristics</a><a id="GC-Trigger-Heuristics-1"></a><a class="docs-heading-anchor-permalink" href="#GC-Trigger-Heuristics" title="Permalink"></a></h2><p>Julia&#39;s GC heuristics are based on <code>MemBalancer</code> (https://dl.acm.org/doi/10.1145/3563323). They decide when to trigger a collection and which (quick or full) collection to trigger. The heuristics adjust the number of bytes the mutator can allocate before triggering a collection cycle by measuring metrics such as allocation rate, freeing rate, and current heap size.</p><p>Independently of allocation rates, freeing rates, or GC times, Julia will always trigger full collections if the heap size exceeds 80% of a memory upper bound specified through <code>--heap-size-hint</code> or determined by reading system information.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gc-sa/">« Static analyzer annotations for GC correctness in C code</a><a class="docs-footer-nextpage" href="../gc-mmtk/">Julia + MMTk »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 17 December 2025 11:36">Wednesday 17 December 2025</span>. Using Julia version 1.14.0-DEV.1376.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
